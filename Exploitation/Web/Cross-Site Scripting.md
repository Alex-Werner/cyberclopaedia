# Overview
Cross-site scripting (XSS) describes the set of attacks where the attacker injects Javascript into a web application, typically because user input isn't properly sanitised. It is similar to HTML injection, however, it allows for the execution of Javascript code and that makes it a potentially critical vulnerability.

XSS vulnerabilities can be exploited in three major ways:
- stored (persistent) XSS
- reflected XSS
- DOM-based XSS

These attacks usually require user interaction.

# Reflected XSS
Reflected XSS occurs when an application receives data which it then includes in its reply to the submitted HTTP request. This is typically exploited by creating a malicious link containing a script inside it and then tricking a user into clicking visiting that URL.

This type of XSS allows the attacker to perform any action on the application as the target. It is commonly used for stealing non-`httponly` cookies.

Suppose you have a search bar somewhere in your application, the contents of which are sent as a URL parameter in a `GET` request when a user clicks the search button and are then displayed on the response page in a similar manner:
```
Search results for: <search text>
```
The request could be to the following example URL:

```
example.com/?search=val
```

If your application is vulnerable to XSS, the attacker could craft a malicious URL like the following one:

```
example.com/?search=<script>alert('test')</script>
```

This would inject the Javascript as HTML into the `<search text>` on the response page and the browser would then execute the code.

# Stored XSS
Stored, or persistent, XSS is similar to reflected XSS, with the difference being that the injected code is actually stored onto the web server and then later distributed to anyone who requests the injected web page. This type of XSS is much more severe, since it can spread around. 

Once Javascript has been injected and stored on the web server, the malicious Javascript will be delivered to and executed by any user who requests the specific web page.

# DOM-based XSS
DOM-based XSS is a type of XSS where the malicious code is never sent to the server. This commonly occurs when using the fragment part of a URL, or by referencing `document.URL` / `document.location.href`.

This a less common attack nowadays, since most browser automatically escape Javascript in address bars, so DOM-based XSS will only work if you unescape it.

Suppose you have a page on 
```
http://127.0.0.1:8080/example.html
```

You can add fragments to the URL with a # symbol.

```
http://127.0.0.1:8080/example.html#test=val
```

The fragment part (`#test=val`) is never sent to the server - it is only available locally.

Suppose you had the following client-side Javascript code running:

```js
const pos = document.URL.indexOf("test=") + 5;
const value = document.URL.substring(document.URL.indexOf("test=") + 5, document.URL.length);

document.write(value);
```

An attacker could craft the following URL:
```
http://127.0.0.1:8080/example.html#test=<script>alert('xss')</script>
```

However, if a victim clicks on this link, no Javascript should be injected, since the browser would usually automatically escape it - you would get
```
%3Cscript%3Ealert('xss')%3C/script%3E
```
printed on the page. If you, however, unescape the Javascript in your client-side code, it will get executed.
